<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MigraciÃ³n Refuerzos</title>
</head>
<body>
  <h2>MigraciÃ³n Refuerzos (solo una vez)</h2>
  <button id="btnMigrar">ðŸš€ Ejecutar migraciÃ³n</button>

  <script type="module">
    import { db } from "./js/firebase.js";
    import {
      collection,
      getDocs,
      updateDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    async function migrarRefuerzos() {
      console.log("ðŸ”„ Iniciando migraciÃ³n...");

      const snap = await getDocs(collection(db, "refuerzos_calidad"));
      let actualizados = 0;

      for (const d of snap.docs) {
        const r = d.data();

        // Si ya tiene responsableFirmaUrl, NO tocar
        if (r.responsableFirmaUrl) continue;

        // Migrar responsable antiguo
        const updates = {
          responsableNombre: r.responsableNombre || "",
          responsableCargo: r.responsableCargo || "",
          responsableFirmaUrl: r.firmaResponsable || "",
        };

        await updateDoc(doc(db, "refuerzos_calidad", d.id), updates);
        actualizados++;
        console.log("âœ” Migrado:", d.id);
      }

      alert(`MigraciÃ³n completa. Refuerzos actualizados: ${actualizados}`);
      console.log("âœ… MigraciÃ³n finalizada");
    }

    document
      .getElementById("btnMigrar")
      .addEventListener("click", migrarRefuerzos);
  </script>
</body>
</html>
