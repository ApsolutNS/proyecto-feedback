<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal del Agente — Calidad</title>

  <!-- Material Symbols -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <!-- CSS -->
  <link rel="stylesheet" href="css/portal_agente.css">
</head>

<body class="theme-light">

<!-- ================= TOPBAR ================= -->
<header class="topbar">
  <div class="topbar-left">
    <span class="material-symbols-outlined topbar-logo">shield_person</span>
    <div>
      <div class="topbar-title">Portal del Agente</div>
      <div class="topbar-subtitle">Feedback & Refuerzos · Calidad</div>
    </div>
  </div>

  <div class="topbar-right">
    <button id="themeToggle" class="icon-button" title="Cambiar tema">
      <span id="themeIcon" class="material-symbols-outlined">dark_mode</span>
    </button>

    <div class="agent-pill">
      <span class="material-symbols-outlined">person</span>
      <span id="agentNameSpan">Agente</span>
    </div>

    <button id="btnLogout" class="outlined-button">
      <span class="material-symbols-outlined">logout</span>
      <span>Cerrar sesión</span>
    </button>
  </div>
</header>

<!-- ================= LAYOUT ================= -->
<main class="page-shell with-aside">

  <!-- ========== ASIDE IZQUIERDO ========== -->
  <aside class="aside-panel">

    <!-- === CARD: ÍTEMS CON MAYOR OPORTUNIDAD === -->
    <section class="card">
      <div class="card-header">
        <h3>Ítems con mayor oportunidad</h3>
        <p class="card-subtitle">
          Ítems que más impactan tu nota promedio
        </p>
      </div>

      <div id="agentItemsRisk" class="risk-list">
        <div class="small">Cargando análisis…</div>
      </div>
    </section>

  </aside>

  <!-- ========== CONTENIDO PRINCIPAL ========== -->
  <section class="main-panel">

    <!-- ===== RESUMEN ===== -->
    <section class="card">
      <div class="card-header">
        <h2>Resumen de desempeño</h2>
        <p class="card-subtitle">
          Promedio y conteos basados en tus feedbacks
        </p>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-label">Promedio general</div>
          <div class="kpi-value" id="avgScore">–</div>
        </div>

        <div class="kpi-card">
          <div class="kpi-label">Total feedbacks</div>
          <div class="kpi-value" id="totalFb">–</div>
        </div>

        <div class="kpi-card kpi-ok">
          <div class="kpi-label">Aprobados (≥85%)</div>
          <div class="kpi-value" id="okCount">–</div>
        </div>

        <div class="kpi-card kpi-bad">
          <div class="kpi-label">No aprobados (&lt;85%)</div>
          <div class="kpi-value" id="badCount">–</div>
        </div>
      </div>
    </section>

    <!-- ===== FILTROS ===== -->
    <section class="card">
      <div class="filters-row">
        <div class="field">
          <label>Tipo de documento</label>
          <select id="selTipoDoc">
            <option value="registros">Feedback de calidad</option>
            <option value="refuerzos_calidad">Refuerzos / Capacitaciones</option>
          </select>
        </div>

        <div class="field">
          <label>Registrado por</label>
          <select id="selRegistrador">
            <option value="">Todos</option>
          </select>
        </div>

        <div id="pendingBadge"></div>
      </div>
    </section>

    <!-- ===== TABLA ===== -->
    <section class="card">
      <div class="table-wrapper">
        <table id="agentTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Fecha</th>
              <th>Detalle</th>
              <th>Estado</th>
              <th class="col-actions">Acción</th>
            </tr>
          </thead>
          <tbody>
            <!-- dinámico -->
          </tbody>
        </table>
      </div>
    </section>

  </section>
</main>

<!-- ================= MODAL DETALLE ================= -->
<div id="detailOverlay" class="dialog-backdrop" aria-hidden="true">
  <div class="dialog" role="dialog" aria-modal="true">
    <div class="dialog-header">
      <div>
        <h2 id="detailTitle">Detalle</h2>
        <p id="detailSubtitle" class="dialog-subtitle"></p>
      </div>
      <button id="detailClose" class="icon-button">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <div id="detailScroll" class="dialog-body">
      <div id="feedbackInfo"></div>

      <div id="editableZone" class="editable-zone">
        <h3>Compromiso del agente</h3>

        <textarea id="compromiso" rows="3"
          placeholder="Describe tu compromiso..."></textarea>

        <div class="signature-actions">
          <button id="btnDraw" class="filled-button">
            <span class="material-symbols-outlined">gesture</span>
            Dibujar firma
          </button>

          <button id="btnUpload" class="outlined-button">
            <span class="material-symbols-outlined">upload</span>
            Subir imagen
          </button>

          <input id="fileSignature" type="file" accept="image/*" hidden>
        </div>

        <div id="signaturePreview" class="signature-preview-empty">
          Sin firma seleccionada
        </div>

        <button id="btnSaveCommit" class="filled-button full">
          <span class="material-symbols-outlined">check_circle</span>
          Enviar compromiso y firma
        </button>

        <p id="agentMsg" class="helper-text"></p>
      </div>
    </div>
  </div>
</div>

<!-- ================= MODAL FIRMA ================= -->
<div id="signatureModal" class="dialog-backdrop" aria-hidden="true">
  <div class="dialog dialog-signature">
    <div class="dialog-header">
      <h2>Dibujar firma</h2>
      <button id="btnCancel" class="icon-button">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <div class="dialog-body">
      <canvas id="sigCanvas" width="700" height="160"></canvas>
    </div>

    <div class="dialog-footer">
      <button id="btnClear" class="outlined-button">
        Limpiar
      </button>
      <button id="btnUse" class="filled-button">
        Usar firma
      </button>
    </div>
  </div>
</div>

<!-- ================= JS ================= -->
<script type="module" src="js/portal_agente.js"></script>

</body>
</html>
