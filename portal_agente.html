<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal del Agente ‚Äî Feedback & Refuerzos</title>
  <link rel="stylesheet" href="css/portal_agente.css">
</head>
<body>
  <div class="pa-root">
    <!-- TOP BAR -->
    <header class="pa-topbar">
      <div class="pa-topbar-left">
        <div class="pa-app-title">Feedback Center</div>
        <div class="pa-app-subtitle">Portal del Agente</div>
      </div>
      <div class="pa-topbar-right">
        <button class="pa-icon-button" id="btnTheme" aria-label="Cambiar tema">
          üåô
        </button>
        <div class="pa-user-chip">
          <div class="pa-user-avatar">AG</div>
          <div class="pa-user-info">
            <span class="pa-user-name" id="agentNameSpan">(Agente)</span>
            <span class="pa-user-role">Agente</span>
          </div>
        </div>
        <button class="pa-tonal-button" id="btnLogout">
          Cerrar sesi√≥n
        </button>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <main class="pa-main">
      <!-- COLUMNA IZQUIERDA: FILTROS + TABLA -->
      <section class="pa-main-left">
        <!-- FILTROS -->
        <div class="pa-card pa-filters-card">
          <div class="pa-card-header">
            <h2>Mis documentos</h2>
            <span id="pendingBadge" class="pa-pending-badge"></span>
          </div>
          <div class="pa-filters-grid">
            <div class="pa-field">
              <label for="selTipoDoc">Tipo de documento</label>
              <select id="selTipoDoc">
                <option value="registros">Feedback de calidad</option>
                <option value="refuerzos_calidad">Refuerzos / Capacitaciones</option>
              </select>
            </div>
            <div class="pa-field">
              <label for="selRegistrador">Registrado por</label>
              <select id="selRegistrador">
                <option value="">Todos</option>
                <option value="Alex Paolo Nu√±ez Sulca - L√≠der de Calidad y Formaci√≥n">
                  Alex Paolo Nu√±ez Sulca - L√≠der de Calidad y Formaci√≥n
                </option>
                <option value="C√©sar Alonso Torres Montes - Supervisor">
                  C√©sar Alonso Torres Montes - Supervisor
                </option>
                <option value="Karen Vanessa Vital Cordova - L√≠der de Operaciones">
                  Karen Vanessa Vital Cordova - L√≠der de Operaciones
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- TABLA -->
        <div class="pa-card pa-table-card">
          <div class="pa-table-wrapper">
            <table id="agentTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Detalle</th>
                  <th>Estado</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="5" style="text-align:center;font-size:13px;">
                    Cargando documentos...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- COLUMNA DERECHA: DASHBOARD -->
      <aside class="pa-main-right">
        <div class="pa-card">
          <div class="pa-card-header">
            <h2>Mi resumen</h2>
          </div>
          <div id="agentStats" class="pa-kpi-grid">
            <div class="pa-kpi-card">
              <div class="pa-kpi-label">Promedio general</div>
              <div class="pa-kpi-value" id="avgScore">‚Äì</div>
            </div>
            <div class="pa-kpi-card">
              <div class="pa-kpi-label">Total feedbacks</div>
              <div class="pa-kpi-value" id="totalFb">‚Äì</div>
            </div>
            <div class="pa-kpi-card">
              <div class="pa-kpi-label">Aprobados (‚â•85%)</div>
              <div class="pa-kpi-value pa-kpi-ok" id="okCount">‚Äì</div>
            </div>
            <div class="pa-kpi-card">
              <div class="pa-kpi-label">No aprobados (&lt;85%)</div>
              <div class="pa-kpi-value pa-kpi-bad" id="badCount">‚Äì</div>
            </div>
          </div>
          <p class="pa-kpi-helper">
            El resumen se calcula solo con tus feedbacks de la colecci√≥n
            <strong>registros</strong>.
          </p>
        </div>
      </aside>
    </main>
  </div>

  <!-- MODAL DETALLE DOCUMENTO -->
  <div id="detailModal" class="pa-modal-backdrop">
    <div class="pa-modal pa-modal-lg">
      <div class="pa-modal-surface">
        <header class="pa-modal-header">
          <div>
            <h2 id="detailTitle">Detalle</h2>
            <p id="detailSubtitle" class="pa-modal-subtitle">
              Informaci√≥n del documento seleccionado
            </p>
          </div>
          <button class="pa-icon-button" id="btnCloseDetail" aria-label="Cerrar detalle">
            ‚úï
          </button>
        </header>
        <div class="pa-modal-body">
          <div id="feedbackInfo"></div>

          <!-- ZONA EDITABLE (COMPROMISO + FIRMA) -->
          <div id="editableZone" class="pa-editable-zone">
            <h3>Acciones del agente</h3>
            <div class="pa-field">
              <label for="compromiso">Compromiso del agente</label>
              <textarea id="compromiso" rows="3"
                placeholder="Escribe tu compromiso o plan de mejora."></textarea>
            </div>

            <div class="pa-field">
              <label>Firma del agente</label>
              <div class="pa-row">
                <button class="pa-filled-button" id="btnDraw">
                  ‚úèÔ∏è Dibujar firma
                </button>
                <button class="pa-tonal-button" id="btnUpload">
                  üìÅ Subir imagen
                </button>
                <input id="fileSignature" type="file" accept="image/*" hidden>
              </div>
              <div id="signaturePreview" class="signature-preview-empty">
                Sin firma seleccionada
              </div>
            </div>

            <div class="pa-row pa-row-end">
              <button class="pa-filled-button pa-filled-button-primary" id="btnSave">
                Enviar firma y completar
              </button>
            </div>
            <p id="agentMsg" class="pa-agent-msg"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DIBUJAR FIRMA -->
  <div id="signatureModal" class="pa-modal-backdrop">
    <div class="pa-modal pa-modal-sm">
      <div class="pa-modal-surface">
        <header class="pa-modal-header">
          <div>
            <h2>Dibujar firma</h2>
            <p class="pa-modal-subtitle">
              Firma con el mouse o tu dedo si est√°s en un dispositivo t√°ctil.
            </p>
          </div>
          <button class="pa-icon-button" id="btnCancel" aria-label="Cerrar">
            ‚úï
          </button>
        </header>
        <div class="pa-modal-body">
          <canvas id="sigCanvas" width="700" height="160"></canvas>
        </div>
        <footer class="pa-modal-footer">
          <button class="pa-tonal-button" id="btnClear">
            Limpiar
          </button>
          <button class="pa-tonal-button" id="btnUse">
            Usar firma
          </button>
        </footer>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script type="module" src="js/portal_agente.js"></script>
</body>
</html>
