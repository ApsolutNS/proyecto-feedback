<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal del Agente — Feedback Center</title>

  <!-- Fuente + Material Symbols (iconos Google) -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

  <!-- Estilos del portal -->
  <link rel="stylesheet" href="css/portal_agente.css" />
</head>
<body class="pa-body">
  <div class="pa-root">

    <!-- TOP APP BAR -->
    <header class="pa-appbar">
      <div class="pa-appbar-left">
        <div class="pa-app-title">FEEDBACK CENTER</div>
        <div class="pa-app-subtitle">Portal del Agente</div>
      </div>

      <div class="pa-appbar-right">
        <div class="pa-user-chip">
          <span class="material-symbols-rounded pa-user-icon">account_circle</span>
          <div class="pa-user-info">
            <span id="agentNameSpan" class="pa-user-name">...</span>
            <span class="pa-user-role">Agente de calidad</span>
          </div>
        </div>

        <button id="themeToggle" class="pa-icon-button" type="button" aria-label="Cambiar tema">
          <span class="material-symbols-rounded" id="themeIcon">dark_mode</span>
        </button>

        <button id="btnLogout" class="pa-icon-button" type="button" aria-label="Cerrar sesión">
          <span class="material-symbols-rounded">logout</span>
        </button>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="pa-main">
      <!-- TARJETAS KPI -->
      <section class="pa-kpi-row">
        <article class="pa-kpi-card">
          <div class="pa-kpi-label">Promedio general</div>
          <div id="avgScore" class="pa-kpi-value">–</div>
        </article>
        <article class="pa-kpi-card">
          <div class="pa-kpi-label">Total feedbacks</div>
          <div id="totalFb" class="pa-kpi-value">–</div>
        </article>
        <article class="pa-kpi-card">
          <div class="pa-kpi-label">Aprobados (≥85%)</div>
          <div id="okCount" class="pa-kpi-value pa-kpi-ok">–</div>
        </article>
        <article class="pa-kpi-card">
          <div class="pa-kpi-label">No aprobados (&lt;85%)</div>
          <div id="badCount" class="pa-kpi-value pa-kpi-bad">–</div>
        </article>
      </section>

      <!-- FILTROS + TABLA -->
      <section class="pa-surface">
        <div class="pa-surface-header">
          <div class="pa-surface-title">Historial de documentos</div>
          <div id="pendingBadge" class="pa-pending-badge"></div>
        </div>

        <div class="pa-filters">
          <div class="pa-field">
            <label for="selTipoDoc" class="pa-label">Tipo de documento</label>
            <div class="pa-select-wrapper">
              <select id="selTipoDoc" class="pa-select">
                <option value="registros">Feedback de calidad</option>
                <option value="refuerzos_calidad">Refuerzos / Capacitaciones</option>
              </select>
              <span class="material-symbols-rounded pa-select-icon">expand_more</span>
            </div>
          </div>

          <div class="pa-field">
            <label for="selRegistrador" class="pa-label">Registrado por</label>
            <div class="pa-select-wrapper">
              <select id="selRegistrador" class="pa-select">
                <option value="">Todos</option>
                <option value="Alex Paolo Nuñez Sulca - Líder de Calidad y Formación">
                  Alex Paolo Nuñez Sulca - Líder de Calidad y Formación
                </option>
                <option value="César Alonso Torres Montes - Supervisor">
                  César Alonso Torres Montes - Supervisor
                </option>
                <option value="Karen Vanessa Vital Cordova - Líder de Operaciones">
                  Karen Vanessa Vital Cordova - Líder de Operaciones
                </option>
              </select>
              <span class="material-symbols-rounded pa-select-icon">expand_more</span>
            </div>
          </div>
        </div>

        <div class="pa-table-wrapper">
          <table class="pa-table" id="agentTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Detalle</th>
                <th>Estado</th>
                <th class="pa-th-actions">Acción</th>
              </tr>
            </thead>
            <tbody>
              <!-- filas generadas por JS -->
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL DETALLE DOCUMENTO -->
  <div id="detailModal" class="pa-modal-backdrop" aria-hidden="true">
    <div class="pa-modal-surface pa-modal-lg">
      <header class="pa-modal-header">
        <div>
          <div class="pa-modal-title" id="detailTitle">Detalle del documento</div>
          <div class="pa-modal-subtitle" id="detailSubtitle">
            Carta de retroalimentación de calidad
          </div>
        </div>
        <button id="btnCloseModal" class="pa-icon-button" type="button" aria-label="Cerrar detalle">
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>

      <div class="pa-modal-body">
        <!-- Contenido de la carta -->
        <div id="feedbackInfo" class="pa-letter"></div>

        <!-- ZONA EDITABLE (COMPR + FIRMA) -->
        <div id="editableZone" class="pa-editable-zone">
          <h3 class="pa-section-heading">Acciones del agente</h3>

          <div class="pa-field">
            <label for="compromiso" class="pa-label">Compromiso del agente</label>
            <textarea id="compromiso" class="pa-textarea" rows="3"
              placeholder="Escribe tu compromiso concreto de mejora."></textarea>
          </div>

          <div class="pa-field">
            <label class="pa-label">Firma del agente</label>
            <div class="pa-row pa-row-gap">
              <button id="btnDraw" class="pa-tonal-button" type="button">
                <span class="material-symbols-rounded">edit</span>
                Dibujar firma
              </button>
              <button id="btnUpload" class="pa-outlined-button" type="button">
                <span class="material-symbols-rounded">folder_open</span>
                Subir imagen
              </button>
              <input id="fileSignature" type="file" accept="image/*" hidden />
            </div>
            <div id="signaturePreview" class="pa-signature-preview-empty">
              Sin firma seleccionada
            </div>
          </div>

          <div class="pa-row pa-row-end">
            <span id="agentMsg" class="pa-helper-text"></span>
            <button id="btnSave" class="pa-filled-button" type="button">
              Enviar firma y completar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL PARA DIBUJAR FIRMA -->
  <div id="signatureModal" class="pa-modal-backdrop" aria-hidden="true">
    <div class="pa-modal-surface pa-modal-md">
      <header class="pa-modal-header">
        <div>
          <div class="pa-modal-title">Dibujar firma</div>
          <div class="pa-modal-subtitle">
            Usa el mouse o el dedo (en pantallas táctiles).
          </div>
        </div>
        <button id="btnCloseSig" class="pa-icon-button" type="button" aria-label="Cerrar">
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>

      <div class="pa-modal-body">
        <canvas id="sigCanvas" width="720" height="200" class="pa-canvas"></canvas>
        <div class="pa-row pa-row-end pa-row-gap">
          <button id="btnClear" class="pa-outlined-button" type="button">
            <span class="material-symbols-rounded">ink_eraser</span>
            Limpiar
          </button>
          <button id="btnUse" class="pa-filled-button" type="button">
            Usar firma
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS del portal -->
  <script type="module" src="js/portal_agente.js"></script>
</body>
</html>
