<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Refuerzos & Capacitaciones â€“ Calidad FE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Estilos -->
  <link rel="stylesheet" href="css/refuerzos.css" />

  <!-- html2pdf (para exportar PDF, permitido por tu CSP) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js" defer></script>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-left">
      <div class="header-title">
        <span class="logo">FE</span>
        Refuerzos & Capacitaciones
      </div>
      <div class="header-sub">
        Registro oficial de acciones de Calidad & FormaciÃ³n â€“ Financiera Efectiva.
      </div>
      <div class="header-meta">
        <div class="pill">
          <span class="pill-dot"></span>
          MÃ³dulo interno de Calidad
        </div>
        <div class="pill">
          Responsable: Alex Paolo NuÃ±ez Sulca â€“ LÃ­der de Calidad y FormaciÃ³n
        </div>
      </div>
    </div>
    <div class="header-right">
      <button id="btnIrBuscador" class="btn-sm">ðŸ”Ž Ir al Dashboard</button>
      <button id="themeToggle" class="btn-toggle">ðŸŒ™ Modo oscuro</button>
    </div>
  </header>

  <!-- CONTENEDOR PRINCIPAL -->
  <div class="container">
    <div class="layout-grid">
      <!-- FORMULARIO -->
      <section class="card" id="cardFormulario">
        <div class="card-header">
          <div>
            <div class="card-title">Nuevo refuerzo / capacitaciÃ³n</div>
            <div class="card-sub">
              Registra solo acciones formales de refuerzo, feedback o capacitaciÃ³n asociadas a Calidad.
            </div>
          </div>
          <span class="chip">Solo Calidad & FormaciÃ³n</span>
        </div>

        <div class="form-grid">
          <div>
            <label for="fecha">Fecha del refuerzo</label>
            <input type="date" id="fecha" />
          </div>

          <div>
            <label for="tipo">Tipo de acciÃ³n</label>
            <select id="tipo">
              <option value="">Seleccione</option>
              <option>CapacitaciÃ³n grupal</option>
              <option>Refuerzo 1:1</option>
              <option>Feedback de calidad</option>
              <option>Recordatorio normativo</option>
              <option>Coaching / role play</option>
            </select>
          </div>

          <div>
            <label for="tema">Tema / tÃ­tulo</label>
            <input id="tema" placeholder="Ej. Manejo de objeciones SBS / Script de bienvenida" />
          </div>

          <div>
            <label for="canal">Canal</label>
            <select id="canal">
              <option value="">Seleccione</option>
              <option>Presencial</option>
              <option>Teams</option>
              <option>Llamada</option>
              <option>Otro</option>
            </select>
          </div>

          <!-- ASESORES -->
          <div class="chips-wrapper">
            <div class="chips-label-row">
              <span class="hint"><b>Asesores capacitados</b> (selecciÃ³n mÃºltiple)</span>
              <span class="hint">Datos en tiempo real desde colecciÃ³n <b>asesores</b></span>
            </div>
            <div id="asesoresContainer" class="chips-container"></div>
          </div>

          <div>
            <label for="responsable">Responsable</label>
            <input
              id="responsable"
              value="Alex Paolo NuÃ±ez Sulca - LÃ­der de Calidad y FormaciÃ³n"
              readonly
            />
          </div>
        </div>

        <div style="margin-top: 10px">
          <label for="objetivo">Objetivo del refuerzo</label>
          <textarea
            id="objetivo"
            rows="2"
            placeholder="Ej. Reforzar cumplimiento SBS en fase de ofrecimiento, reducir errores de cierre, etc."
          ></textarea>
        </div>

        <div style="margin-top: 10px">
          <label for="detalle">Detalle / acuerdos clave</label>
          <textarea
            id="detalle"
            rows="3"
            placeholder="Puntos especÃ­ficos tratados, compromisos, indicadores a monitorear, etc."
          ></textarea>
        </div>

        <div class="form-footer">
          <div class="hint">
            <div>âœ” Luego el agente podrÃ¡ firmar este refuerzo desde <b>portal_agente.html</b>.</div>
            <div>âœ” El PDF se genera desde aquÃ­ con las firmas de Alex + agentes.</div>
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap">
            <button class="btn-secondary" type="button" id="btnLimpiar">Limpiar</button>
            <button class="btn" type="button" id="btnGuardar">ðŸ’¾ Guardar refuerzo</button>
          </div>
        </div>
      </section>

      <!-- LISTADO -->
      <section class="card" id="cardListado">
        <div class="card-header">
          <div>
            <div class="card-title">Historial de refuerzos</div>
            <div class="card-sub">
              Vista ejecutiva del avance de firmas y estado de cada acciÃ³n de calidad.
            </div>
          </div>
        </div>

        <!-- MÃ‰TRICAS -->
        <div class="metrics-row">
          <div class="metric-pill">
            Total refuerzos: <span class="metric-value" id="metricTotal">0</span>
          </div>
          <div class="metric-pill">
            Firmados: <span class="metric-value" id="metricFirmados">0</span>
          </div>
          <div class="metric-pill">
            Pendientes de firma: <span class="metric-value" id="metricPendientes">0</span>
          </div>
        </div>

        <!-- FILTROS -->
        <div class="filters-row">
          <input
            id="searchTabla"
            class="search-input"
            placeholder="Buscar por agente, tema, tipo, pÃºblicoâ€¦"
          />
          <select id="filtroEstado" class="compact">
            <option value="todos">Estado: todos</option>
            <option value="pendiente">Pendiente de firma</option>
            <option value="firmado">Firmado</option>
            <option value="incompleto">Datos incompletos</option>
          </select>
        </div>

        <!-- TABLA -->
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Tema / Tipo</th>
                <th>PÃºblico</th>
                <th>Firma</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaRefuerzos"></tbody>
          </table>
        </div>

        <div
          style="
            margin-top: 8px;
            font-size: 11px;
            color: var(--muted);
            display: flex;
            justify-content: space-between;
            gap: 6px;
            flex-wrap: wrap;
          "
        >
          <span class="badge-inline">
            <span class="badge-dot-success"></span> Firmado por agente
          </span>
          <span class="badge-inline">
            <span class="badge-dot-warning"></span> Pendiente de firma / datos
          </span>
        </div>
      </section>
    </div>
  </div>

  <!-- OVERLAY CARGA -->
  <div id="loadingOverlay">
    <div id="loadingText">Procesandoâ€¦</div>
    <div class="loader-bar">
      <div class="loader-bar-inner"></div>
    </div>
  </div>

  <!-- MODAL PDF -->
  <div id="pdfModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="modal-header">
        <span id="pdfModalTitle">Vista previa del refuerzo</span>
        <button class="modal-close" id="pdfCloseBtn">âœ•</button>
      </div>
      <div class="modal-body">
        <div id="pdfContentRefuerzo" class="pdf-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" type="button" id="pdfDownloadBtn">â¬‡ Descargar PDF</button>
        <button class="btn-secondary" type="button" id="pdfCloseBtnFooter">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- LÃ“GICA -->
  <script type="module" src="js/refuerzos.js"></script>
</body>
</html>
